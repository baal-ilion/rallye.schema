<div class="container mb-3 w-100" *ngIf="param">

  <div class="row">
    <div class="col-12 py-1 bg-info">
      <h2 class="text-center text-white">Equipe {{stageResult.team}} / Epreuve {{stageResult.stage}}</h2>
    </div>
  </div>

  <div class="row mt-1">
    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="container col-12">

      <!----------------------->
      <!-- Begin / end dates -->
      <!----------------------->

      <div class="row justify-content-center">
        <div class="col-8 col-sm-6 col-md-5 col-lg-4 col-xl-3 col-xxl-2 m-2 p-0 border">
          <label class="raw col-12 m-0 p-1 text-center">Début :</label>
          <div class="raw col-12 m-0 p-1 justify-content-center input-group">
            <input class="form-control rounded-left" placeholder="yyyy-mm-dd" name="dp" formControlName="begindate" ngbDatepicker #d="ngbDatepicker">
            <div class="input-group-append">
              <button class="btn btn-outline-secondary calendar rounded-right" (click)="d.toggle()" type="button"></button>
            </div>
          </div>
          <div class="row col-12 m-0 p-1 justify-content-center">
            <ngb-timepicker clformControlName="begintime" seconds="true" [spinners]="false"></ngb-timepicker>
          </div>
          <div class="row col-12 m-0 p-1 justify-content-center">
            <button class="btn btn-danger" type="button" *ngIf="stageResult && stageResult.begin && !stageResult.end" (click)="onCancelStage()">Annuler</button>
          </div>
        </div>

        <div class="col-8 col-sm-6 col-md-5 col-lg-4 col-xl-3 col-xxl-2 m-2 p-0 border">
          <label class="raw col-12 m-0 p-1 text-center">Fin :</label>
          <div class="raw col-12 m-0 p-1 justify-content-center input-group">
            <input class="form-control rounded-left" placeholder="yyyy-mm-dd" name="dp" formControlName="enddate" ngbDatepicker #e="ngbDatepicker">
            <div class="input-group-append">
              <button class="btn btn-outline-secondary calendar rounded-right" (click)="e.toggle()" type="button"></button>
            </div>
          </div>
          <div class="row col-12 m-0 p-1 justify-content-center">
            <ngb-timepicker formControlName="endtime" seconds="true" [spinners]="false"></ngb-timepicker>
          </div>
          <div class="row col-12 m-0 p-1 justify-content-center">
            <button class="btn btn-danger" type="button" *ngIf="stageResult && stageResult.begin && stageResult.end" (click)="onUndoStage()">Annuler</button>
          </div>
        </div>
      </div>

      <!---------------------------------->
      <!-- Questions on response sheets -->
      <!---------------------------------->

      <!-- TODO formatage si la page n'est pas encore importée -->

      <div *ngIf="files.length > 0" class="row">
        <div *ngFor="let file of files" class="col-12">

          <div class="row mt-3 text-left">
            <h3 class="col-12 py-2 bg-light">Questions sur la page {{file.page}} du formulaire de réponses</h3>
          </div>

          <div class="row">
            <!-- The response sheets are displayed only on medium or bigger screens -->
            <section class="col-12 col-xxl-10 d-none d-md-block">
              <div class="row justify-content-center">
                <app-details-response-file [fileUpload]="file" [dragable]="false" (checkedEvent)="reload()" (deleteEvent)="reload()" class="border"></app-details-response-file>
              </div>
            </section>

            <!-- If the screen is extra-large, the switches are displayed on the right of the sheet only -->
            <!-- else the switches are displayed below the sheet                                         -->
            <section class="col-12 col-xxl-2">
              <div class="row h-100">
                <div class="col-12 d-none d-xxl-block" style="height:25.59%"></div>
                <div class="col-12 d-flex align-content-between flex-wrap p-0" style="height:61.11%">
                  <div *ngFor="let item of [].constructor(38); let i = index" class="col-3 col-md-2 col-xxl-12 p-0">
                    <div class="row">
                      <label class="col-4 my-auto p-0 small text-right">Qxxx</label>
                      <div class="col-8 my-auto px-1 py-0 justify-content-start">
                        <ui-switch size="small"></ui-switch>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-12 d-none d-xxl-block" style="height:13.30%"></div>
              </div>
            </section>
          </div>

<!-- TODO -->
          <div class="row justify-content-center mt-2">
            <button type="button" class="btn btn-success mx-2">Accepter</button>
            <button type="button" class="btn btn-danger mx-2">Refuser</button>
            <button type="button" class="btn btn-primary mx-2">Chercher les doublons</button>
          </div>

          <!--
          <div class="row justify-content-center mt-2">
            <button type="button" *ngIf="!file.checked" class="btn btn-success mx-2" (click)="check()">Accepter</button>
            <button type="button" class="btn btn-danger mx-2" (click)="delete()">Refuser</button>
            <button type="button" *ngIf="sames.length > 0" class="btn btn-primary mx-2" (click)="showSameResponseFile()">Chercher les doublons</button>
          </div>
          -->
<!-- !TODO -->

        </div>
      </div>

      <!--------------------------------------->
      <!-- Questions without response sheets -->
      <!--------------------------------------->

<!-- TODO -->
      <div *ngIf="results.controls.length > 0">

        <div class="row mt-3 text-left">
          <h3 class="col-12 py-2 bg-light">Questions hors formulaire de réponses</h3>
        </div>

        <div class="row">
          <div *ngFor="let result of results.controls" class="col-3 col-md-2 col-xxl-1">

            <div [formGroup]="result" class="row">
              <label class="col-4 my-auto p-0 small text-right">{{result.value.name}}</label>
              <div class="col-8 my-auto px-1 py-0 justify-content-start ">
                <ui-switch formControlName="resultValue" size="small"></ui-switch>
              </div>
            </div>
          </div>
        </div>

        </div>
<!-- !TODO -->

      <!------------------>
      <!-- Performances -->
      <!------------------>

      <div *ngIf="performances.controls.length > 0">
        <div class="row mt-3 text-left">
          <h3 class="col-12 py-2 bg-light">Performances</h3>
        </div>

        <div class="row">
          <div *ngFor="let performance of performances.controls" class="col-6 col-md-4 col-lg-3 col-xl-2">

            <div [formGroup]="performance" class="row">
              <label class="col-4 m-0 px-0 py-0 small text-right">{{performance.value.name}}</label>
              <div class="col-8 m-0 px-1 py-0 justify-content-start ">
                <input type=number step=any formControlName="performanceValue" class="col-auto small" />
              </div>
            </div>
          </div>
        </div>
      </div>

      <!---------------->
      <!-- Validation -->
      <!---------------->

      <div class="row mt-3 text-left">
        <h3 class="col-12 py-2 bg-light">Validation de la correction</h3>
      </div>

      <div class="row justify-content-center mt-2">

        <div *ngIf="stageResult?.checked" class="text-center align-middle mx-2 px-1 py-0">
          <button class="btn btn-danger" type="submit" [disabled]="form.invalid" (click)="form.patchValue({checked: false})">Invalider</button>
        </div>

        <div *ngIf="stageResult && !stageResult.checked" class="text-center align-middle mx-2 px-1 py-0">
          <button  class="btn btn-success" type="submit" [disabled]="form.invalid" (click)="form.patchValue({checked: true})">Valider</button>
        </div>

        <div class="text-center align-middle mx-2 px-1 py-0">
          <button class="btn btn-primary" type="submit" [disabled]="form.invalid">Enregister</button>
        </div>

      </div>
    </form>

  </div>
</div>
